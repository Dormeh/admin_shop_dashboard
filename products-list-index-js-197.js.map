{"version":3,"sources":["webpack://project-structure/./src/components/sortable-table/index.js","webpack://project-structure/./src/components/double-slider/index.js","webpack://project-structure/./src/components/sort-panel/index.js","webpack://project-structure/./src/pages/products/list/products-header.js","webpack://project-structure/./src/pages/products/list/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["SortableTable","constructor","headersConfig","url","sorted","id","find","item","sortable","order","isSortLocally","step","start","end","from","to","filtered","this","async","bottom","element","getBoundingClientRect","document","documentElement","clientHeight","loading","data","loadData","update","event","column","target","closest","dataset","newOrder","asc","desc","toggleOrder","append","subElements","arrow","sortLocally","sortOnServer","URL","process","render","wrapper","createElement","innerHTML","getTable","firstElementChild","getSubElements","renderRows","initEventListeners","searchParams","set","price_gte","price_lte","title_like","status","classList","add","fetchJson","remove","addRows","body","getTableRows","length","rows","childNodes","getTableHeader","map","getHeaderRow","join","title","getHeaderSortingArrow","getTableBody","getTableRow","template","header","addEventListener","onSortClick","onWindowScroll","sortedData","sortData","arr","sortType","customSorting","direction","sort","a","b","localeCompare","querySelectorAll","reduce","accum","subElement","removeEventListener","destroy","DoubleSlider","min","max","formatValue","value","selected","preventDefault","thumbLeft","thumbRight","inner","progress","left","innerLeft","right","innerRight","width","dragging","newLeft","clientX","shiftX","parseFloat","style","getValue","newRight","onThumbPointerMove","onThumbPointerUp","dispatchEvent","CustomEvent","detail","bubbles","originalMin","originalMax","ondragstart","onThumbPointerDown","rangeTotal","Math","floor","reset","thumbElem","round","SortPanel","sliderMin","sliderMax","initComponents","doubleSlider","components","renderComponents","Object","keys","forEach","component","root","$element","values","category","Page","sliderOriginalFrom","sliderOriginalTo","type","sliderFrom","sliderTo","sortableTable","sortableTableElem","sortPanel","filterName","filterStatus","filterNameValue","filterStatusValue","filterProducts","Date","getTime","modifyEmptyPlaceholder","resetFiltersButton","querySelector","resetFilters","removeEventListeners","emptyPlaceholder","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","message","Error","super","window","reason","alert"],"mappings":"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","file":"products-list-index-js-197.js","sourcesContent":["import fetchJson from \"../../utils/fetch-json.js\";\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL;\r\n\r\nexport default class SortableTable {\r\n  element;\r\n  subElements = {};\r\n  data = [];\r\n  loading = false;\r\n  step = 20;\r\n  start = 1;\r\n  end = this.start + this.step;\r\n\r\n  onWindowScroll = async () => {\r\n    const { bottom } = this.element.getBoundingClientRect();\r\n    const { id, order } = this.sorted;\r\n\r\n    if (bottom < document.documentElement.clientHeight && !this.loading && !this.isSortLocally) {\r\n      this.start = this.end;\r\n      this.end = this.start + this.step;\r\n\r\n      this.loading = true;\r\n\r\n      const data = await this.loadData(id, order, this.start, this.end);\r\n      this.update(data);\r\n\r\n      this.loading = false;\r\n    }\r\n  };\r\n\r\n  onSortClick = event => {\r\n    const column = event.target.closest('[data-sortable=\"true\"]');\r\n    const toggleOrder = order => {\r\n      const orders = {\r\n        asc: 'desc',\r\n        desc: 'asc'\r\n      };\r\n\r\n      return orders[order];\r\n    };\r\n\r\n    if (column) {\r\n      const { id, order } = column.dataset;\r\n      const newOrder = toggleOrder(order);\r\n\r\n      this.sorted = {\r\n        id,\r\n        order: newOrder\r\n      };\r\n\r\n      column.dataset.order = newOrder;\r\n      column.append(this.subElements.arrow);\r\n\r\n      if (this.isSortLocally) {\r\n        this.sortLocally(id, newOrder);\r\n      } else {\r\n        this.start = 1;\r\n        this.end = 1 + this.step;\r\n        this.sortOnServer(id, newOrder, this.start, this.end);\r\n      }\r\n    }\r\n  };\r\n\r\n  constructor(headersConfig = [], {\r\n    url = '',\r\n    sorted = {\r\n      id: headersConfig.find(item => item.sortable).id,\r\n      order: 'asc'\r\n    },\r\n    isSortLocally = false,\r\n    step = 20,\r\n    start = 1,\r\n    end = start + step,\r\n    from = null,\r\n    to = null,\r\n    filtered = null,\r\n  } = {}) {\r\n\r\n    this.headersConfig = headersConfig;\r\n    this.url = new URL(url, BACKEND_URL);\r\n    this.sorted = sorted;\r\n    this.isSortLocally = isSortLocally;\r\n    this.step = step;\r\n    this.start = start;\r\n    this.end = end;\r\n    //In ISO format, use Date.toISOString\r\n    this.from = from;\r\n    this.to = to;\r\n    this.filtered = filtered;\r\n\r\n    this.render();\r\n  }\r\n\r\n  async render() {\r\n    const {id, order} = this.sorted;\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getTable();\r\n\r\n    const element = wrapper.firstElementChild;\r\n\r\n    this.element = element;\r\n    this.subElements = this.getSubElements(element);\r\n\r\n    const data = await this.loadData(id, order, this.start, this.end);\r\n\r\n    this.renderRows(data);\r\n    this.initEventListeners();\r\n    return this.element;\r\n  }\r\n\r\n  async loadData (id, order, start = this.start, end = this.end) {\r\n    if (this.from && this.to) {\r\n      this.url.searchParams.set('createdAt_gte', this.from);\r\n      this.url.searchParams.set('createdAt_lte', this.to);\r\n    }\r\n\r\n    if (this.filtered) {\r\n      const { price_gte, price_lte, title_like, status } = this.filtered;\r\n\r\n      this.url.searchParams.set('price_gte', price_gte);\r\n      this.url.searchParams.set('price_lte', price_lte);\r\n      \r\n      if (title_like) {\r\n        this.url.searchParams.set('title_like', title_like);\r\n      }\r\n\r\n      if (status) {\r\n        this.url.searchParams.set('status', status);\r\n      }\r\n\r\n    }\r\n\r\n    this.url.searchParams.set('_sort', id);\r\n    this.url.searchParams.set('_order', order);\r\n    this.url.searchParams.set('_start', start);\r\n    this.url.searchParams.set('_end', end);\r\n\r\n    this.element.classList.add('sortable-table_loading');\r\n    \r\n\r\n    const data = await fetchJson(this.url);\r\n\r\n    this.element.classList.remove('sortable-table_loading');\r\n\r\n    return data;\r\n  }\r\n\r\n  addRows (data) {\r\n    this.data = data;\r\n    this.subElements.body.innerHTML = this.getTableRows(data);\r\n\r\n    if (data.length) {\r\n      this.element.classList.remove('sortable-table_empty');\r\n    } else {\r\n      this.element.classList.add('sortable-table_empty');\r\n    }\r\n  }\r\n\r\n  update (data) {\r\n    const rows = document.createElement('div');\r\n\r\n    this.data = [...this.data, ...data];\r\n    rows.innerHTML = this.getTableRows(data);\r\n\r\n    this.subElements.body.append(...rows.childNodes);\r\n    return rows;\r\n  }\r\n\r\n  getTableHeader() {\r\n    return `<div data-element=\"header\" class=\"sortable-table__header sortable-table__row\">\r\n      ${this.headersConfig.map(item => this.getHeaderRow(item)).join('')}\r\n    </div>`;\r\n  }\r\n\r\n  getHeaderRow ({id, title, sortable}) {\r\n    const order = this.sorted.id === id ? this.sorted.order : 'asc';\r\n\r\n    return `\r\n      <div class=\"sortable-table__cell\" data-id=\"${id}\" data-sortable=\"${sortable}\" data-order=\"${order}\">\r\n        <span>${title}</span>\r\n        ${this.getHeaderSortingArrow(id)}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getHeaderSortingArrow (id) {\r\n    const isOrderExist = this.sorted.id === id ? this.sorted.order : '';\r\n\r\n    return isOrderExist\r\n      ? `<span data-element=\"arrow\" class=\"sortable-table__sort-arrow\">\r\n          <span class=\"sort-arrow\"></span>\r\n        </span>`\r\n      : '';\r\n  }\r\n\r\n  getTableBody(data) {\r\n    return `\r\n      <div data-element=\"body\" class=\"sortable-table__body\">\r\n        ${this.getTableRows(data)}\r\n      </div>`;\r\n  }\r\n\r\n  getTableRows (data) {\r\n    return data.map(item => `\r\n      <a href=\"/products/${item.id}\" class=\"sortable-table__row\">\r\n        ${this.getTableRow(item, data)}\r\n      </a>`\r\n    ).join('');\r\n  }\r\n\r\n  getTableRow (item) {\r\n    const cells = this.headersConfig.map(({id, template}) => {\r\n      return {\r\n        id,\r\n        template\r\n      }\r\n    });\r\n\r\n    return cells.map(({id, template}) => {\r\n      return template\r\n        ? template(item[id])\r\n        : `<div class=\"sortable-table__cell\">${item[id]}</div>`\r\n    }).join('');\r\n  }\r\n\r\n  getTable() {\r\n    return `\r\n      <div class=\"sortable-table\">\r\n        ${this.getTableHeader()}\r\n        ${this.getTableBody(this.data)}\r\n\r\n        <div data-element=\"loading\" class=\"loading-line sortable-table__loading-line\"></div>\r\n\r\n        <div data-element=\"emptyPlaceholder\" class=\"sortable-table__empty-placeholder\">\r\n          No data\r\n        </div>\r\n      </div>`;\r\n  }\r\n\r\n  initEventListeners () {\r\n    this.subElements.header.addEventListener('pointerdown', this.onSortClick);\r\n    document.addEventListener('scroll', this.onWindowScroll);\r\n  }\r\n\r\n  sortLocally (id, order) {\r\n    const sortedData = this.sortData(id, order);\r\n\r\n    this.subElements.body.innerHTML = this.getTableBody(sortedData);\r\n  }\r\n\r\n  async sortOnServer (id, order, start, end) {\r\n    const data = await this.loadData(id, order, start, end);\r\n\r\n    this.renderRows(data);\r\n  }\r\n\r\n  renderRows (data) {\r\n    if (data.length) {\r\n      this.element.classList.remove('sortable-table_empty');\r\n      this.addRows(data);\r\n    } else {\r\n      this.element.classList.add('sortable-table_empty');\r\n    }\r\n  }\r\n\r\n  sortData (id, order) {\r\n    const arr = [...this.data];\r\n    const column = this.headersConfig.find(item => item.id === id);\r\n    const {sortType, customSorting} = column;\r\n    const direction = order === 'asc' ? 1 : -1;\r\n\r\n    return arr.sort((a, b) => {\r\n      switch (sortType) {\r\n        case 'number':\r\n          return direction * (a[id] - b[id]);\r\n        case 'string':\r\n          return direction * a[id].localeCompare(b[id], 'ru');\r\n        case 'custom':\r\n          return direction * customSorting(a, b);\r\n        default:\r\n          return direction * (a[id] - b[id]);\r\n      }\r\n    });\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    document.removeEventListener('scroll', this.onWindowScroll);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.subElements = {};\r\n  }\r\n}\r\n","export default class DoubleSlider {\r\n  element;\r\n  subElements = {};\r\n\r\n  onThumbPointerMove = event => {\r\n    event.preventDefault();\r\n\r\n    const MIN_PERCENTAGE = 0;\r\n    const MAX_PERCENTAGE = 100;\r\n    const { thumbLeft, thumbRight, inner, progress, from, to } = this.subElements;\r\n    const { left: innerLeft, right: innerRight, width } = inner.getBoundingClientRect();\r\n\r\n    if (this.dragging === thumbLeft) {\r\n      let newLeft = (event.clientX - innerLeft + this.shiftX) / width;\r\n\r\n      if (newLeft < MIN_PERCENTAGE) {\r\n        newLeft = MIN_PERCENTAGE;\r\n      }\r\n\r\n      newLeft *= MAX_PERCENTAGE;\r\n\r\n      const right = parseFloat(thumbRight.style.right);\r\n\r\n      if (newLeft + right > MAX_PERCENTAGE) {\r\n        newLeft = MAX_PERCENTAGE - right;\r\n      }\r\n\r\n      this.dragging.style.left = `${newLeft}%`;\r\n      progress.style.left = `${newLeft}%`;\r\n      from.innerHTML = this.formatValue(this.getValue().from);\r\n    } else {\r\n      let newRight = (innerRight - event.clientX - this.shiftX) / width;\r\n\r\n      if (newRight < MIN_PERCENTAGE) {\r\n        newRight = MIN_PERCENTAGE;\r\n      }\r\n      newRight *= MAX_PERCENTAGE;\r\n\r\n      let left = parseFloat(this.subElements.thumbLeft.style.left);\r\n\r\n      if (left + newRight > MAX_PERCENTAGE) {\r\n        newRight = MAX_PERCENTAGE - left;\r\n      }\r\n      this.dragging.style.right = `${newRight}%`;\r\n      progress.style.right = `${newRight}%`;\r\n      to.innerHTML = this.formatValue(this.getValue().to);\r\n    }\r\n  };\r\n\r\n  onThumbPointerUp = () => {\r\n    this.element.classList.remove('range-slider_dragging');\r\n\r\n    document.removeEventListener('pointermove', this.onThumbPointerMove);\r\n    document.removeEventListener('pointerup', this.onThumbPointerUp);\r\n\r\n    this.element.dispatchEvent(new CustomEvent('range-select', {\r\n      detail: this.getValue(),\r\n      bubbles: true\r\n    }));\r\n  };\r\n\r\n  constructor({\r\n    min = 100,\r\n    max = 200,\r\n    formatValue = value => '$' + value,\r\n    selected = {\r\n      from: min,\r\n      to: max\r\n    }\r\n  } = {}) {\r\n    this.min = min;\r\n    this.max = max;\r\n    this.originalMin = this.min;\r\n    this.originalMax = this.max;\r\n    this.formatValue = formatValue;\r\n    this.selected = selected;\r\n\r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    const { from, to } = this.selected;\r\n\r\n    return `<div class=\"range-slider\">\r\n      <span data-element=\"from\">${this.formatValue(from)}</span>\r\n      <div data-element=\"inner\" class=\"range-slider__inner\">\r\n        <span data-element=\"progress\" class=\"range-slider__progress\"></span>\r\n        <span data-element=\"thumbLeft\" class=\"range-slider__thumb-left\"></span>\r\n        <span data-element=\"thumbRight\" class=\"range-slider__thumb-right\"></span>\r\n      </div>\r\n      <span data-element=\"to\">${this.formatValue(to)}</span>\r\n    </div>`;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.element.ondragstart = () => false;\r\n\r\n    this.subElements = this.getSubElements(element);\r\n\r\n    this.initEventListeners();\r\n\r\n    this.update();\r\n  }\r\n\r\n  initEventListeners() {\r\n    const { thumbLeft, thumbRight } = this.subElements;\r\n\r\n    thumbLeft.addEventListener('pointerdown', event => this.onThumbPointerDown(event));\r\n    thumbRight.addEventListener('pointerdown', event => this.onThumbPointerDown(event));\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    document.removeEventListener('pointermove', this.onThumbPointerMove);\r\n    document.removeEventListener('pointerup', this.onThumbPointerUp);\r\n  }\r\n\r\n  update() {\r\n    const { progress, thumbLeft, thumbRight } = this.subElements;\r\n    const rangeTotal = this.max - this.min;\r\n    const left = Math.floor((this.selected.from - this.min) / rangeTotal * 100) + '%';\r\n    const right = Math.floor((this.max - this.selected.to) / rangeTotal * 100) + '%';\r\n\r\n    progress.style.left = left;\r\n    progress.style.right = right;\r\n\r\n    thumbLeft.style.left = left;\r\n    thumbRight.style.right = right;\r\n  }\r\n\r\n  reset() {\r\n    const { from, to } = this.subElements;\r\n\r\n    this.min = this.originalMin;\r\n    this.selected.from = this.originalMin;\r\n    from.innerHTML = this.formatValue(this.originalMin);\r\n\r\n    this.max = this.originalMax;\r\n    this.selected.to = this.originalMax;\r\n    to.innerHTML = this.formatValue(this.originalMax);\r\n\r\n    this.update();\r\n  }\r\n\r\n  onThumbPointerDown(event) {\r\n    const thumbElem = event.target;\r\n\r\n    event.preventDefault();\r\n\r\n    const { left, right } = thumbElem.getBoundingClientRect();\r\n\r\n    if (thumbElem === this.subElements.thumbLeft) {\r\n      this.shiftX = right - event.clientX;\r\n    } else {\r\n      this.shiftX = left - event.clientX;\r\n    }\r\n\r\n    this.dragging = thumbElem;\r\n\r\n    this.element.classList.add('range-slider_dragging');\r\n\r\n    document.addEventListener('pointermove', this.onThumbPointerMove);\r\n    document.addEventListener('pointerup', this.onThumbPointerUp);\r\n  }\r\n\r\n  getValue() {\r\n    const { thumbLeft, thumbRight } = this.subElements;\r\n    const rangeTotal = this.max - this.min;\r\n    const { left } = thumbLeft.style;\r\n    const { right } = thumbRight.style;\r\n\r\n    const from = Math.round(this.min + parseFloat(left) * 0.01 * rangeTotal);\r\n    const to = Math.round(this.max - parseFloat(right) * 0.01 * rangeTotal);\r\n\r\n    return { from, to };\r\n  }\r\n}","import DoubleSlider from '../../components/double-slider/index.js';\r\n\r\nexport default class SortPanel {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  constructor({\r\n    sliderMin = 0,\r\n    sliderMax = 4000\r\n  } = {}) {\r\n    this.sliderMin = sliderMin;\r\n    this.sliderMax = sliderMax;\r\n\r\n    this.render();\r\n  }\r\n\r\n  initComponents () {\r\n    const doubleSlider = new DoubleSlider({\r\n      min: this.sliderMin,\r\n      max: this.sliderMax, \r\n    });\r\n\r\n    this.components.doubleSlider = doubleSlider;\r\n  }\r\n\r\n  get template () {\r\n    return `\r\n    <div class=\"content-box content-box_small\">\r\n      <form class=\"form-inline\">\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Сортировать по:</label>\r\n          <input type=\"text\" data-element=\"filterName\" class=\"form-control\" placeholder=\"Название товара\">\r\n        </div>\r\n      <div data-element=\"doubleSlider\">\r\n        <!-- double-slider component -->\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label class=\"form-label\">Статус:</label>\r\n        <select class=\"form-control\" data-element=\"filterStatus\">\r\n          <option value=\"\" selected=\"\">Любой</option>\r\n          <option value=\"1\">Активный</option>\r\n          <option value=\"0\">Неактивный</option>\r\n        </select>\r\n      </div>\r\n    </form>\r\n  </div>`;\r\n  }\r\n\r\n  render () {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(this.element);\r\n\r\n    this.initComponents();\r\n\r\n    this.renderComponents();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  renderComponents () {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  getSubElements ($element) {\r\n    const elements = $element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  destroy () {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n\r\n","const header = [\r\n  {\r\n    id: 'images',\r\n    title: 'Image',\r\n    sortable: false,\r\n    template: data => {\r\n      return `\r\n          <div class=\"sortable-table__cell\">\r\n            <img class=\"sortable-table-image\" alt=\"Image\" src=\"${(data[0]) ? data[0].url : \"\"}\">\r\n          </div>\r\n        `;\r\n    }\r\n  },\r\n  {\r\n    id: 'title',\r\n    title: 'Name',\r\n    sortable: true,\r\n    sortType: 'string'\r\n  },\r\n  {\r\n    id: 'subcategory',\r\n    title: 'Subcategory',\r\n    sortable: false,\r\n    template: data => {\r\n      return `\r\n        <div class=\"sortable-table__cell\">\r\n          ${(data.category && data.title)  \r\n            ? `<span data-tooltip=\r\n              \"\r\n                <div class=&quot;sortable-table-tooltip&quot;>\r\n                  <span class=&quot;sortable-table-tooltip__category&quot;>${(data.category) ? data.category.title : ''}</span> /\r\n                  <b class=&quot;sortable-table-tooltip__subcategory&quot;>${data.title}</b>\r\n                </div>\r\n              \">\r\n                ${data.title}\r\n              </span> `\r\n            : \"-\"}\r\n        </div>\r\n        `;\r\n    }\r\n  },\r\n  {\r\n    id: 'quantity',\r\n    title: 'Quantity',\r\n    sortable: true,\r\n    sortType: 'number'\r\n  },\r\n  {\r\n    id: 'price',\r\n    title: 'Price',\r\n    sortable: true,\r\n    sortType: 'number',\r\n    template: data => {\r\n      return `<div class=\"sortable-table__cell\">$${data}</div>`;\r\n    }\r\n  },\r\n  {\r\n    id: 'status',\r\n    title: 'Status',\r\n    sortable: true,\r\n    sortType: 'number',\r\n    template: data => {\r\n      return `<div class=\"sortable-table__cell\">\r\n          ${data > 0 ? 'Active' : 'Inactive'}\r\n        </div>`;\r\n    }\r\n  },\r\n];\r\n\r\nexport default header;\r\n","import SortableTable from '../../../components/sortable-table/index.js';\r\nimport SortPanel from '../../../components/sort-panel/index.js';\r\nimport header from './products-header.js';\r\nimport fetchJson from '../../../utils/fetch-json.js';\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL;\r\nconst PRODUCTS_URL = \"api/rest/products\";\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n  sliderOriginalFrom = 0;\r\n  sliderOriginalTo = 4000;\r\n  sliderFrom = this.sliderOriginalFrom;\r\n  sliderTo = this.sliderOriginalTo;\r\n\r\n  filterProducts = async (event) => {\r\n    const { type, detail } = event;\r\n\r\n    if (type === \"range-select\") {\r\n      const { from, to } = detail;\r\n      this.sliderFrom = from;\r\n      this.sliderTo = to;\r\n    }\r\n    \r\n    // reset these values each time a filter is added or changed\r\n    // in order to load data with filter each time from the beginning\r\n    this.components.sortableTable.start = 1;\r\n    this.components.sortableTable.end = 1 + this.components.sortableTable.step;\r\n    \r\n    const { sorted, start, end, element: sortableTableElem } = this.components.sortableTable;\r\n    const { id, order } = sorted;\r\n    \r\n    sortableTableElem.classList.add(\"sortable-table_loading\");\r\n    \r\n    const { subElements } = this.components.sortPanel;\r\n    const { filterName, filterStatus } = subElements;\r\n    const { value: filterNameValue } = filterName;\r\n    const { value: filterStatusValue } = filterStatus;\r\n\r\n    const url = new URL(PRODUCTS_URL, BACKEND_URL);\r\n\r\n    url.searchParams.set(\"price_gte\", this.sliderFrom);\r\n    url.searchParams.set(\"price_lte\", this.sliderTo);\r\n\r\n    if (filterNameValue) {\r\n      url.searchParams.set(\"title_like\", filterNameValue);\r\n    }\r\n\r\n    if (filterStatusValue) {\r\n      url.searchParams.set(\"status\", filterStatusValue);\r\n    }\r\n\r\n    url.searchParams.set('_sort', id);\r\n    url.searchParams.set('_order', order);\r\n    url.searchParams.set('_start', start);\r\n    url.searchParams.set('_end', end);\r\n    \r\n    //preserve this for server side sorting and for onscroll loading\r\n    this.components.sortableTable.filtered = {\r\n      \"price_gte\": this.sliderFrom,\r\n      \"price_lte\": this.sliderTo,\r\n      \"title_like\": filterNameValue,\r\n      \"status\": filterStatusValue\r\n    }\r\n\r\n    const data = await fetchJson(url);\r\n    this.components.sortableTable.addRows(data);\r\n\r\n    sortableTableElem.classList.remove(\"sortable-table_loading\");\r\n  }\r\n\r\n  resetFilters = (event) => {\r\n    event.preventDefault();\r\n\r\n    const { subElements, components } = this.components.sortPanel;\r\n    const { filterName, filterStatus } = subElements;\r\n    const { doubleSlider } = components;\r\n\r\n    filterName.value = \"\";\r\n    filterStatus.value = \"\";\r\n    this.sliderFrom = this.sliderOriginalFrom;\r\n    this.sliderTo = this.sliderOriginalTo;\r\n    \r\n    doubleSlider.reset();\r\n\r\n    this.filterProducts(event);\r\n  }\r\n\r\n  async initComponents () {\r\n    const to = new Date();\r\n    const from = new Date(to.getTime() - (30 * 24 * 60 * 60 * 1000));\r\n\r\n    const sortPanel = new SortPanel({\r\n      sliderMin: this.sliderFrom,\r\n      sliderMax: this.sliderTo\r\n    });\r\n\r\n    const sortableTable = new SortableTable(header, {\r\n      url: `api/rest/products?_embed=subcategory.category&_sort=title&_order=asc&_start=0&_end=30`\r\n    });\r\n\r\n    this.components.sortPanel = sortPanel;\r\n    this.components.sortableTable = sortableTable;\r\n  }\r\n\r\n  get template () {\r\n    return `\r\n    <div class=\"products-list\">\r\n      <div class=\"content__top-panel\">\r\n        <h1 class=\"page-title\">Товары</h1>\r\n        <a href=\"/products/add\" class=\"button-primary\">Добавить товар</a>\r\n      </div>\r\n      <div data-element=\"sortPanel\">\r\n        <!-- sort-panel component -->\r\n      </div>\r\n      <div data-element=\"sortableTable\">\r\n        <!-- sortable-table component -->\r\n      </div>\r\n    </div>`;\r\n  }\r\n\r\n  async render () {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(this.element);\r\n\r\n    await this.initComponents();\r\n\r\n    this.renderComponents();\r\n\r\n    this.modifyEmptyPlaceholder();\r\n\r\n    this.initEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const { subElements } = this.components.sortPanel;\r\n    const { filterName, filterStatus } = subElements;\r\n    const resetFiltersButton = this.element.querySelector(\".button-primary-outline\");\r\n\r\n    for (const element of [filterName, filterStatus]) {\r\n      element.addEventListener(\"input\", this.filterProducts);\r\n    }\r\n\r\n    resetFiltersButton.addEventListener(\"click\", this.resetFilters);\r\n\r\n    this.element.addEventListener(\"range-select\", this.filterProducts);\r\n  }\r\n\r\n  removeEventListeners() {\r\n    const { subElements } = this.components.sortPanel;\r\n    const { filterName, filterStatus } = subElements;\r\n    const resetFiltersButton = this.element.querySelector(\".button-primary-outline\");\r\n\r\n    for (const element of [filterName, filterStatus]) {\r\n      element.removeEventListener(\"input\", this.filterProducts);\r\n    }\r\n\r\n    resetFiltersButton.removeEventListener(\"click\", this.resetFilters);\r\n\r\n    this.element.removeEventListener(\"range-select\", this.filterProducts);\r\n  }\r\n\r\n  modifyEmptyPlaceholder() {\r\n    const { subElements } = this.components.sortableTable;\r\n    const { emptyPlaceholder } = subElements;\r\n    emptyPlaceholder.innerHTML = `\r\n      <div>\r\n        <p>Не найдено товаров удовлетворяющих выбранному критерию</p>\r\n        <button type=\"button\" class=\"button-primary-outline\">Очистить фильтры</button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  renderComponents () {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  getSubElements ($element) {\r\n    const elements = $element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  destroy () {\r\n    this.removeEventListeners(); \r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}