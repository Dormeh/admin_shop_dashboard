{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/components/categories/index.js","webpack://project-structure/./src/pages/categories/index.js","webpack://project-structure/./src/utils/escape-html.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","activeComponent","remove","element","document","createElement","innerHTML","template","firstElementChild","show","body","append","setTimeout","destroy","SortableList","items","clientX","clientY","moveDraggingAt","children","top","firstElementTop","getBoundingClientRect","bottom","movePlaceholderAt","length","i","li","draggingElem","offsetHeight","height","scrollIfCloseToWindowEdge","dragStop","className","addItems","initEventListeners","addEventListener","event","onPointerDown","item","classList","add","which","itemElem","target","closest","preventDefault","dragStart","elementInitialIndex","indexOf","pointerInitialShift","x","y","placeholderElem","style","width","offsetWidth","after","onDocumentPointerMove","onDocumentPointerUp","left","window","scrollBy","documentElement","clientHeight","index","currentElement","insertBefore","placeholderIndex","replaceWith","removeEventListener","dispatchEvent","CustomEvent","bubbles","detail","from","to","Categories","data","isHeader","contains","parentDiv","toggle","async","payload","map","child","id","dataset","weight","send","showNotificationMessage","error","url","URL","process","requestParams","method","headers","JSON","stringify","fetchJson","wrapper","getCategoriesContainerTemplate","appendSubcategoryDraggableList","toggleAccordion","onSortableListReorder","removeEventListeners","getCategoryTemplate","escapeHtml","title","join","createSubcategoryList","subcategories","count","getSortableListItemTemplate","subcategotyListArr","querySelectorAll","forEach","subcategoryElement","sortableList","Page","fetchUrl","searchParams","set","initComponents","categories","components","subElements","getSubElements","getData","renderComponents","Object","keys","component","root","reduce","accum","subElement","values","string","replace","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","status","Error","super","reason","alert"],"mappings":"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","file":"categories-index-js-193.js","sourcesContent":["export default class NotificationMessage {\r\n  static activeComponent;\r\n\r\n  element; // HTMLElement;\r\n\r\n  constructor(\r\n    message, \r\n    {\r\n      duration,\r\n      type\r\n    } = {}) {\r\n    this.message = message;\r\n    this.duration = duration;\r\n    this.type = type;\r\n    \r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"notification notification_${this.type} show\" style=\"--value:${this.duration / 1000}s\">\r\n        <div class=\"notification__content\">\r\n          ${this.message}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render() {\r\n\r\n    if (NotificationMessage.activeComponent) {\r\n      NotificationMessage.activeComponent.remove();\r\n    }\r\n\r\n    const element = document.createElement('div');\r\n    element.innerHTML = this.template;\r\n    this.element = element.firstElementChild;\r\n    NotificationMessage.activeComponent = this.element;\r\n  }\r\n\r\n  show(parent = document.body) {\r\n    parent.append(this.element);\r\n\r\n    setTimeout(() => {\r\n      this.remove();\r\n    }, this.duration);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}","export default class SortableList {\r\n  element;\r\n\r\n  onDocumentPointerMove = ({clientX, clientY}) => {\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    const {firstElementChild, children} = this.element;\r\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\r\n    const {bottom} = this.element.getBoundingClientRect();\r\n\r\n    if (clientY < firstElementTop) {\r\n      this.movePlaceholderAt(0);\r\n    } else if (clientY > bottom) {\r\n      this.movePlaceholderAt(children.length);\r\n    } else {\r\n      for (let i = 0; i < children.length; i++) {\r\n        const li = children[i];\r\n\r\n        if (li !== this.draggingElem) {\r\n          const {top, bottom} = li.getBoundingClientRect();\r\n          const {offsetHeight: height} = li;\r\n\r\n          if (clientY > top && clientY < bottom) {\r\n            if (clientY < top + height / 2) {\r\n              this.movePlaceholderAt(i);\r\n              break;\r\n            } else {\r\n              this.movePlaceholderAt(i + 1);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.scrollIfCloseToWindowEdge(clientY);\r\n  };\r\n\r\n  onDocumentPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({items = []} = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n\r\n    this.addItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', event => this.onPointerDown(event));\r\n  }\r\n\r\n  addItems() {\r\n    for (let item of this.items) {\r\n      item.classList.add('sortable-list__item');\r\n    }\r\n\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  onPointerDown(event) {\r\n    if (event.which !== 1) { // must be left-button\r\n      return false;\r\n    }\r\n\r\n    const itemElem = event.target.closest('.sortable-list__item');\r\n\r\n    if (itemElem) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n\r\n        this.dragStart(itemElem, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n\r\n        itemElem.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  dragStart(itemElem, {clientX, clientY}) {\r\n    this.elementInitialIndex = [...this.element.children].indexOf(itemElem);\r\n\r\n    this.pointerInitialShift = {\r\n      x: clientX - itemElem.getBoundingClientRect().x,\r\n      y: clientY - itemElem.getBoundingClientRect().y\r\n    };\r\n\r\n    this.draggingElem = itemElem;\r\n\r\n    this.placeholderElem = document.createElement('li');\r\n    this.placeholderElem.className = 'sortable-list__placeholder';\r\n\r\n    itemElem.style.width = `${itemElem.offsetWidth}px`;\r\n    itemElem.style.height = `${itemElem.offsetHeight}px`;\r\n\r\n    this.placeholderElem.style.width = itemElem.style.width;\r\n    this.placeholderElem.style.height = itemElem.style.height;\r\n\r\n    itemElem.classList.add('sortable-list__item_dragging');\r\n\r\n    itemElem.after(this.placeholderElem);\r\n\r\n    this.element.append(itemElem);\r\n\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    document.addEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.addEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  moveDraggingAt(clientX, clientY) {\r\n    this.draggingElem.style.left = clientX - this.pointerInitialShift.x + 'px';\r\n    this.draggingElem.style.top = clientY - this.pointerInitialShift.y + 'px';\r\n  }\r\n\r\n  scrollIfCloseToWindowEdge(clientY) {\r\n    const scrollingValue = 10;\r\n    const threshold = 20;\r\n\r\n    if (clientY < threshold) {\r\n      window.scrollBy(0, -scrollingValue);\r\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\r\n      window.scrollBy(0, scrollingValue);\r\n    }\r\n  }\r\n\r\n  movePlaceholderAt(index) {\r\n    const currentElement = this.element.children[index];\r\n\r\n    if (currentElement !== this.placeholderElem) {\r\n      this.element.insertBefore(this.placeholderElem, currentElement);\r\n    }\r\n  }\r\n\r\n  dragStop() {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\r\n\r\n    this.placeholderElem.replaceWith(this.draggingElem);\r\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\r\n\r\n    this.draggingElem.style.left = '';\r\n    this.draggingElem.style.top = '';\r\n    this.draggingElem.style.width = '';\r\n    this.draggingElem.style.height = '';\r\n\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n\r\n    this.draggingElem = null;\r\n\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        detail: {\r\n          from: this.elementInitialIndex,\r\n          to: placeholderIndex\r\n        }\r\n      }));\r\n    }\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}","import escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\nimport SortableList from '../../components/sortable-list/index.js';\r\nimport NotificationMessage from '../../components/notification/index.js';\r\n\r\nexport default class Categories {\r\n\r\n  element; //html element\r\n\r\n  toggleAccordion = (event) => {\r\n    event.preventDefault();\r\n    const {target} = event;\r\n    const isHeader = target.classList.contains(\"category__header\");\r\n    const parentDiv = target.closest(\"div\");\r\n\r\n    if (isHeader) {\r\n      parentDiv.classList.toggle(\"category_open\");\r\n    }\r\n  }\r\n\r\n  onSortableListReorder = async (event) => {\r\n    const { target } = event;\r\n    const { children } = target;\r\n\r\n    const payload = [...children].map((child, index) => {\r\n      const { id } = child.dataset;\r\n\r\n      return {\r\n        id,\r\n        weight: index\r\n      };\r\n    });\r\n\r\n    try {\r\n      await this.send(payload);\r\n      this.showNotificationMessage(\"Category order saved\", {type: \"success\"});\r\n    } catch (error) {\r\n      this.showNotificationMessage(`Server side error! ${error}`, {type: \"error\", duration: 3000});\r\n    }\r\n  }\r\n\r\n  constructor(data) {\r\n    this.data = data;\r\n    this.render();\r\n  }\r\n\r\n  showNotificationMessage(message, {duration = 2000, type} = {}) {\r\n    const notificationMessage = new NotificationMessage(message, {\r\n      duration: duration,\r\n      type: type\r\n    });\r\n    notificationMessage.show();\r\n  }\r\n\r\n  async send(payload) {\r\n    const url = new URL ('api/rest/subcategories', process.env.BACKEND_URL);\r\n    const requestParams = {\r\n      method: 'PATCH',\r\n      headers:             {\r\n        'Content-Type': 'application/json;charset=utf-8'\r\n      },\r\n      body: JSON.stringify(payload)\r\n    }\r\n\r\n    await fetchJson(url, requestParams);\r\n  }\r\n\r\n  render() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = this.getCategoriesContainerTemplate(this.data);\r\n\r\n    const element = wrapper.firstElementChild;\r\n\r\n    this.element = element;\r\n\r\n    this.appendSubcategoryDraggableList();\r\n\r\n    this.initEventListeners();\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener(\"click\", this.toggleAccordion);\r\n    this.element.addEventListener(\"sortable-list-reorder\", this.onSortableListReorder);\r\n  }\r\n\r\n  removeEventListeners() {\r\n    this.element.removeEventListener(\"click\", this.toggleAccordion);\r\n    this.element.removeEventListener(\"sortable-list-reorder\", this.onSortableListReorder);\r\n  }\r\n\r\n  getCategoriesContainerTemplate(data) {\r\n    return `\r\n      <div data-element=\"categoriesContainer\">\r\n        ${this.getCategoryTemplate(data)}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getCategoryTemplate(data) {\r\n    return data\r\n      .map(item => {\r\n        return `\r\n          <div class=\"category category_open\" data-id=\"${item.id}\">\r\n            <header class=\"category__header\">${escapeHtml(item.title)}</header>\r\n            <div class=\"category__body\">\r\n              <div class=\"subcategory-list\" data-element=\"subcategoryList\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `;\r\n      }).join(\"\");\r\n  }\r\n\r\n  createSubcategoryList() {\r\n    return this.data\r\n      .map(element => {\r\n        const { subcategories } = element;\r\n        const items = subcategories.map(({ id, title, count }) => this.getSortableListItemTemplate(id, title, count));\r\n        return items;\r\n      });\r\n  }\r\n\r\n  getSortableListItemTemplate(id, title, count) {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <li class=\"categories__sortable-list-item sortable-list__item\" data-grab-handle=\"\" data-id=\"${id}\">\r\n        <strong>${escapeHtml(title)}</strong>\r\n        <span><b>${count}</b> products</span>\r\n      </li>`;\r\n\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  appendSubcategoryDraggableList() {\r\n    const subcategotyListArr = this.createSubcategoryList();\r\n    const subcategoryElementArr = this.element.querySelectorAll(\"[data-element='subcategoryList']\");\r\n\r\n    subcategoryElementArr.forEach((subcategoryElement, index) => {\r\n      const sortableList = new SortableList({ items: subcategotyListArr[index] });\r\n\r\n      subcategoryElement.append(sortableList.element);\r\n    });\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.removeEventListeners();\r\n    this.remove();\r\n  }\r\n}","import Categories from '../../components/categories/index.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL;\r\nconst CATEGORIES_URL = \"api/rest/categories\";\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n  data = {};\r\n\r\n  async getData () {\r\n    const fetchUrl = new URL(CATEGORIES_URL, BACKEND_URL);\r\n    fetchUrl.searchParams.set(\"_sort\", \"weight\");\r\n    fetchUrl.searchParams.set(\"_refs\", \"subcategory\");\r\n    this.data = await fetchJson(fetchUrl);\r\n  }\r\n\r\n  initComponents () {\r\n\r\n    const categories = new Categories(this.data);\r\n    this.components.categories = categories;\r\n  }\r\n\r\n  get template () {\r\n    return `\r\n    <div class=\"categories\">\r\n      <div class=\"content__top-panel\">\r\n        <h1 class=\"page-title\">Категории товаров</h1>\r\n      </div>\r\n      <div data-element=\"categories\">\r\n        <!-- categories component -->\r\n      </div>\r\n    </div>`;\r\n  }\r\n\r\n  async render () {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    \r\n    this.subElements = this.getSubElements(this.element);\r\n\r\n    await this.getData();\r\n\r\n    this.initComponents();\r\n\r\n    this.renderComponents();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  renderComponents () {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  getSubElements (element) {\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  destroy () {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","export const foo = 1;\r\n\r\nexport default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n\r\n\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}