{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/components/product-form/index.js","webpack://project-structure/./src/pages/products/edit/index.js","webpack://project-structure/./src/utils/escape-html.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","activeComponent","remove","element","document","createElement","innerHTML","template","firstElementChild","show","body","append","setTimeout","destroy","SortableList","items","clientX","clientY","moveDraggingAt","children","top","firstElementTop","getBoundingClientRect","bottom","movePlaceholderAt","length","i","li","draggingElem","offsetHeight","height","scrollIfCloseToWindowEdge","dragStop","className","addItems","initEventListeners","addEventListener","event","onPointerDown","item","classList","add","which","itemElem","target","closest","preventDefault","dragStart","elementInitialIndex","indexOf","pointerInitialShift","x","y","placeholderElem","style","width","offsetWidth","after","onDocumentPointerMove","onDocumentPointerUp","left","window","scrollBy","documentElement","clientHeight","index","currentElement","insertBefore","placeholderIndex","replaceWith","removeEventListener","dispatchEvent","CustomEvent","bubbles","detail","from","to","ProductForm","data","fetchUrl","getFetchUrl","productsUrl","requestParams","method","productId","headers","JSON","stringify","fetchJson","customEventName","productEditMode","showNotificationMessage","url","productForm","imageListContainer","subElements","formData","FormData","payloadFields","formatToNumber","name","value","includes","parseInt","id","images","imagesHTMLCollection","querySelectorAll","image","alt","src","push","source","sendFormData","async","file","inputElement","files","lastElementChild","uploadImageButton","response","Authorization","appendUploadedImageToSortableList","err","fileName","link","sortableImageList","map","getImageItem","sortableList","wrapper","onchange","uploadImage","click","Boolean","categoriesUrl","categories","productData","getAllData","getEditProductFormTemplate","getCreateProductFormTemplate","getSubElements","createImagesList","onUploadImageButtonClick","onFormSubmit","requests","getSingleData","_sort","_refs","productRequest","Promise","all","searchQueryParams","URL","process","param","val","Object","entries","searchParams","set","reduce","accum","subElement","dataset","getTitleTemplate","getDescriptionTemplate","getSortableImageListContainerTemplate","getProductCategoriesTemplate","getProductPriceDiscountTemplate","getProductQuantityTemplate","getProductStatusTemplate","title","escapeHtml","description","productSubcategory","subcategory","categotyTitle","subcategories","subcategoryId","subcategoryTitle","join","price","discount","quantity","status","Page","match","components","initComponents","renderComponents","keys","forEach","component","root","$element","values","string","replace","params","fetch","toString","FetchError","ok","errorText","statusText","json","error","Error","super","reason","alert"],"mappings":"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","file":"products-edit-index-js-460.js","sourcesContent":["export default class NotificationMessage {\r\n  static activeComponent;\r\n\r\n  element; // HTMLElement;\r\n\r\n  constructor(\r\n    message, \r\n    {\r\n      duration,\r\n      type\r\n    } = {}) {\r\n    this.message = message;\r\n    this.duration = duration;\r\n    this.type = type;\r\n    \r\n    this.render();\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"notification notification_${this.type} show\" style=\"--value:${this.duration / 1000}s\">\r\n        <div class=\"notification__content\">\r\n          ${this.message}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render() {\r\n\r\n    if (NotificationMessage.activeComponent) {\r\n      NotificationMessage.activeComponent.remove();\r\n    }\r\n\r\n    const element = document.createElement('div');\r\n    element.innerHTML = this.template;\r\n    this.element = element.firstElementChild;\r\n    NotificationMessage.activeComponent = this.element;\r\n  }\r\n\r\n  show(parent = document.body) {\r\n    parent.append(this.element);\r\n\r\n    setTimeout(() => {\r\n      this.remove();\r\n    }, this.duration);\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}","export default class SortableList {\r\n  element;\r\n\r\n  onDocumentPointerMove = ({clientX, clientY}) => {\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    const {firstElementChild, children} = this.element;\r\n    const {top: firstElementTop} = firstElementChild.getBoundingClientRect();\r\n    const {bottom} = this.element.getBoundingClientRect();\r\n\r\n    if (clientY < firstElementTop) {\r\n      this.movePlaceholderAt(0);\r\n    } else if (clientY > bottom) {\r\n      this.movePlaceholderAt(children.length);\r\n    } else {\r\n      for (let i = 0; i < children.length; i++) {\r\n        const li = children[i];\r\n\r\n        if (li !== this.draggingElem) {\r\n          const {top, bottom} = li.getBoundingClientRect();\r\n          const {offsetHeight: height} = li;\r\n\r\n          if (clientY > top && clientY < bottom) {\r\n            if (clientY < top + height / 2) {\r\n              this.movePlaceholderAt(i);\r\n              break;\r\n            } else {\r\n              this.movePlaceholderAt(i + 1);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.scrollIfCloseToWindowEdge(clientY);\r\n  };\r\n\r\n  onDocumentPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({items = []} = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n\r\n    this.addItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.element.addEventListener('pointerdown', event => this.onPointerDown(event));\r\n  }\r\n\r\n  addItems() {\r\n    for (let item of this.items) {\r\n      item.classList.add('sortable-list__item');\r\n    }\r\n\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  onPointerDown(event) {\r\n    if (event.which !== 1) { // must be left-button\r\n      return false;\r\n    }\r\n\r\n    const itemElem = event.target.closest('.sortable-list__item');\r\n\r\n    if (itemElem) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n\r\n        this.dragStart(itemElem, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n\r\n        itemElem.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  dragStart(itemElem, {clientX, clientY}) {\r\n    this.elementInitialIndex = [...this.element.children].indexOf(itemElem);\r\n\r\n    this.pointerInitialShift = {\r\n      x: clientX - itemElem.getBoundingClientRect().x,\r\n      y: clientY - itemElem.getBoundingClientRect().y\r\n    };\r\n\r\n    this.draggingElem = itemElem;\r\n\r\n    this.placeholderElem = document.createElement('li');\r\n    this.placeholderElem.className = 'sortable-list__placeholder';\r\n\r\n    itemElem.style.width = `${itemElem.offsetWidth}px`;\r\n    itemElem.style.height = `${itemElem.offsetHeight}px`;\r\n\r\n    this.placeholderElem.style.width = itemElem.style.width;\r\n    this.placeholderElem.style.height = itemElem.style.height;\r\n\r\n    itemElem.classList.add('sortable-list__item_dragging');\r\n\r\n    itemElem.after(this.placeholderElem);\r\n\r\n    this.element.append(itemElem);\r\n\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    document.addEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.addEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  moveDraggingAt(clientX, clientY) {\r\n    this.draggingElem.style.left = clientX - this.pointerInitialShift.x + 'px';\r\n    this.draggingElem.style.top = clientY - this.pointerInitialShift.y + 'px';\r\n  }\r\n\r\n  scrollIfCloseToWindowEdge(clientY) {\r\n    const scrollingValue = 10;\r\n    const threshold = 20;\r\n\r\n    if (clientY < threshold) {\r\n      window.scrollBy(0, -scrollingValue);\r\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\r\n      window.scrollBy(0, scrollingValue);\r\n    }\r\n  }\r\n\r\n  movePlaceholderAt(index) {\r\n    const currentElement = this.element.children[index];\r\n\r\n    if (currentElement !== this.placeholderElem) {\r\n      this.element.insertBefore(this.placeholderElem, currentElement);\r\n    }\r\n  }\r\n\r\n  dragStop() {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\r\n\r\n    this.placeholderElem.replaceWith(this.draggingElem);\r\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\r\n\r\n    this.draggingElem.style.left = '';\r\n    this.draggingElem.style.top = '';\r\n    this.draggingElem.style.width = '';\r\n    this.draggingElem.style.height = '';\r\n\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n\r\n    this.draggingElem = null;\r\n\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        detail: {\r\n          from: this.elementInitialIndex,\r\n          to: placeholderIndex\r\n        }\r\n      }));\r\n    }\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n    document.removeEventListener('pointermove', this.onDocumentPointerMove);\r\n    document.removeEventListener('pointerup', this.onDocumentPointerUp);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}","import SortableList from '../../components/sortable-list/index.js';\r\nimport NotificationMessage from '../../components/notification/index.js';\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\r\nconst BACKEND_URL = process.env.BACKEND_URL;\r\n\r\nexport default class ProductForm {\r\n  element; //html element\r\n  inputElement; //html element\r\n  productData = null;\r\n  categories = null;\r\n\r\n  onFormSubmit = (event) => {\r\n    event.preventDefault();\r\n\r\n    const {productForm, imageListContainer} = this.subElements;\r\n    const formData = new FormData(productForm);\r\n    const data = {};\r\n    const payloadFields = [\r\n      \"title\",\r\n      \"description\",\r\n      \"subcategory\",\r\n      \"price\",\r\n      \"quantity\",\r\n      \"discount\",\r\n      \"status\"\r\n    ];\r\n    const formatToNumber = [\"price\", \"quantity\", \"discount\", \"status\"];\r\n\r\n    for (let [name, value] of formData) {\r\n      if (payloadFields.includes(name)) {\r\n        value = (formatToNumber.includes(name))\r\n          ? parseInt(value, 10)\r\n          : value;\r\n        data[name] = value;\r\n      }\r\n    }\r\n\r\n    if (this.productEditMode) {\r\n      data.id = this.productId;\r\n    }\r\n\r\n    data.images = [];\r\n\r\n    const imagesHTMLCollection = imageListContainer.querySelectorAll('.sortable-table__cell-img');\r\n\r\n    for (const image of imagesHTMLCollection) {\r\n      const {alt, src} = image;\r\n      data.images.push({\r\n        url: src,\r\n        source: alt\r\n      });\r\n    }\r\n\r\n    this.sendFormData(data);\r\n  }\r\n\r\n  async sendFormData(data) {\r\n    const fetchUrl = this.getFetchUrl(this.productsUrl);\r\n\r\n    const requestParams = {\r\n      method: this.productId ? 'PATCH' : 'PUT',\r\n      headers:             {\r\n        'Content-Type': 'application/json;charset=utf-8'\r\n      },\r\n      body: JSON.stringify(data)\r\n    }\r\n\r\n    await fetchJson(fetchUrl, requestParams);\r\n\r\n    const customEventName = (this.productEditMode) ? \"product-updated\" : \"product-saved\";\r\n    this.element.dispatchEvent(new CustomEvent(customEventName, {\r\n      bubbles: true,\r\n      detail: event\r\n    }));\r\n\r\n  }\r\n\r\n  uploadImage = async () => {\r\n    const [file] = this.inputElement.files;\r\n\r\n    if (!file) return;\r\n\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const {lastElementChild: uploadImageButton} = this.subElements[\"sortable-list-container\"];\r\n    uploadImageButton.classList.add(\"is-loading\");\r\n\r\n    let response;\r\n\r\n    try {\r\n\r\n      response = await fetchJson('https://api.imgur.com/3/image', {\r\n        method: 'POST',\r\n        headers:             {\r\n          Authorization: `Client-ID ${IMGUR_CLIENT_ID}`\r\n        },\r\n        body: formData,\r\n      });\r\n      this.showNotificationMessage(`Image upload succeeded!`, {type: \"success\"});\r\n      this.appendUploadedImageToSortableList(file, response);\r\n\r\n    } catch (err) {\r\n\r\n      this.showNotificationMessage(`Upload to the server failed! Please try again later! ${err}`, {type: \"error\", duration: 3000});\r\n\r\n    } finally {\r\n\r\n      uploadImageButton.classList.remove(\"is-loading\");\r\n\r\n    }\r\n  }\r\n\r\n  showNotificationMessage(message, {duration = 2000, type} = {}) {\r\n    const notificationMessage = new NotificationMessage(message, {\r\n      duration: duration,\r\n      type: type\r\n    });\r\n    notificationMessage.show();\r\n  }\r\n\r\n  appendUploadedImageToSortableList = (file, response) => {\r\n    const {name: fileName} = file;\r\n    const {link} = response.data;\r\n\r\n    const {firstElementChild: sortableImageList} = this.subElements.imageListContainer;\r\n\r\n    const images = [\r\n      {\r\n        url: link,\r\n        source: fileName\r\n      }\r\n    ];\r\n\r\n    const items = images.map(({url, source}) => this.getImageItem(url, source));\r\n\r\n    const sortableList = new SortableList({\r\n      items\r\n    });\r\n\r\n    sortableImageList.append(sortableList.element);\r\n  }\r\n\r\n  onUploadImageButtonClick = (event) => {\r\n    event.preventDefault();\r\n\r\n    const wrapper = document.createElement('div');\r\n    wrapper.innerHTML = '<input type=\"file\" accept=\"image/*\" hidden=\"\">'\r\n    this.inputElement = wrapper.firstElementChild;\r\n    document.body.append(this.inputElement);\r\n\r\n    this.inputElement.onchange = this.uploadImage;\r\n\r\n    this.inputElement.click();\r\n  }\r\n\r\n  // TODO: check if it is a good place for url param or it should be put outside of class\r\n  constructor(productId, url = \"api/rest/products\") {\r\n    this.productId = productId;\r\n    this.productEditMode = Boolean(this.productId);\r\n    this.productsUrl = url;\r\n    this.categoriesUrl = \"api/rest/categories\";\r\n  }\r\n\r\n  async render() {\r\n\r\n    const wrapper = document.createElement('div');\r\n\r\n    [this.categories, this.productData] = await this.getAllData(this.productEditMode);\r\n\r\n    if (this.productEditMode) {\r\n      wrapper.innerHTML = this.getEditProductFormTemplate(this.productData, this.categories);\r\n    } else {\r\n      wrapper.innerHTML = this.getCreateProductFormTemplate(this.categories);\r\n    }\r\n\r\n    const element = wrapper.firstElementChild;\r\n\r\n    this.element = element;\r\n\r\n    this.subElements = this.getSubElements();\r\n\r\n    this.createImagesList();\r\n\r\n    this.initEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const uploadImageButton = this.subElements[\"sortable-list-container\"].lastElementChild;\r\n\r\n    uploadImageButton.addEventListener(\"click\", this.onUploadImageButtonClick);\r\n    this.element.addEventListener(\"submit\", this.onFormSubmit);\r\n  }\r\n\r\n  async getAllData(productEditMode) {\r\n    const categoriesRequest = this.getSingleData(this.categoriesUrl, {_sort: \"weight\", _refs: \"subcategory\"});\r\n\r\n    const requests = [\r\n      categoriesRequest\r\n    ]\r\n\r\n    if (productEditMode) {\r\n      const productRequest = this.getSingleData(this.productsUrl, {id: this.productId});\r\n      requests.push(productRequest);\r\n    }\r\n\r\n    return await Promise.all(requests);\r\n  }\r\n\r\n  async getSingleData(url, searchQueryParams) {\r\n    const fetchUrl = this.getFetchUrl(url, searchQueryParams);\r\n    const response = await fetchJson(fetchUrl);\r\n    return response;\r\n  }\r\n\r\n  getFetchUrl(url, searchQueryParams) {\r\n    const fetchUrl = new URL(url, BACKEND_URL);\r\n\r\n    if (searchQueryParams) {\r\n      for (let [param, val] of Object.entries(searchQueryParams)) {\r\n        fetchUrl.searchParams.set(param, val);\r\n      }\r\n    }\r\n\r\n    return fetchUrl;\r\n  }\r\n\r\n  getSubElements(element = this.element) {\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  getEditProductFormTemplate([productData], categories) {\r\n    return `\r\n      <div class=\"product-form\">\r\n        <form data-element=\"productForm\" class=\"form-grid\">\r\n          ${this.getTitleTemplate(productData)}\r\n          ${this.getDescriptionTemplate(productData)}\r\n          ${this.getSortableImageListContainerTemplate()}\r\n          ${this.getProductCategoriesTemplate(categories, productData)}\r\n          ${this.getProductPriceDiscountTemplate(productData)}\r\n          ${this.getProductQuantityTemplate(productData)}\r\n          ${this.getProductStatusTemplate(productData)}\r\n          <div class=\"form-buttons\">\r\n            <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n              Сохранить товар\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getTitleTemplate({title}) {\r\n    return `\r\n      <div class=\"form-group form-group__half_left\">\r\n        <fieldset>\r\n          <label class=\"form-label\">Название товара</label>\r\n          <input required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\" value=\"${escapeHtml(title)}\">\r\n        </fieldset>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getDescriptionTemplate({description}) {\r\n    return `\r\n      <div class=\"form-group form-group__wide\">\r\n        <label class=\"form-label\">Описание</label>\r\n        <textarea required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\">${escapeHtml(description)}\"</textarea>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getSortableImageListContainerTemplate() {\r\n    return `\r\n      <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\r\n        <label class=\"form-label\">Фото</label>\r\n        <div data-element=\"imageListContainer\">\r\n        </div>\r\n        <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline\"><span>Загрузить</span></button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getProductCategoriesTemplate(categories, productData) {\r\n    let productSubcategory;\r\n    if (productData) {\r\n      ({subcategory: productSubcategory} = productData);\r\n    }\r\n    return `\r\n      <div class=\"form-group form-group__half_left\">\r\n        <label class=\"form-label\">Категория</label>\r\n        <select class=\"form-control\" name=\"subcategory\">\r\n        ${categories\r\n          .map( ({title: categotyTitle, subcategories}) => {\r\n            return subcategories\r\n              .map( ({id: subcategoryId, title: subcategoryTitle}) => {\r\n                return `\r\n                  <option ${(productSubcategory && productSubcategory === subcategoryId) ? \"selected\" : \"\"} value=\"${subcategoryId}\">${categotyTitle} &gt; ${subcategoryTitle}</option>\r\n                `;\r\n              });\r\n          }).join(\"\")}\r\n        </select>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getProductPriceDiscountTemplate({price, discount}) {\r\n    return `\r\n      <div class=\"form-group form-group__half_left form-group__two-col\">\r\n        <fieldset>\r\n          <label class=\"form-label\">Цена ($)</label>\r\n          <input required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"100\" value=\"${price}\">\r\n        </fieldset>\r\n        <fieldset>\r\n          <label class=\"form-label\">Скидка ($)</label>\r\n          <input required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"0\" value=\"${discount}\">\r\n        </fieldset>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getProductQuantityTemplate({quantity}) {\r\n    return `\r\n      <div class=\"form-group form-group__part-half\">\r\n        <label class=\"form-label\">Количество</label>\r\n        <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"1\" value=\"${quantity}\">\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  getProductStatusTemplate({status}) {\r\n    return `\r\n      <div class=\"form-group form-group__part-half\">\r\n        <label class=\"form-label\">Статус</label>\r\n        <select class=\"form-control\" name=\"status\">\r\n          <option ${(status === 1) ? \"selected\" : \"\"} value=\"1\">Активен</option>\r\n          <option ${(status === 0) ? \"selected\" : \"\"} value=\"0\">Неактивен</option>\r\n        </select>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  createImagesList() {\r\n    if (!this.productData) {\r\n      return;\r\n    };\r\n    const {imageListContainer} = this.subElements;\r\n    const [productData] = this.productData;\r\n    const {images} = productData;\r\n\r\n    const items = images.map(({url, source}) => this.getImageItem(url, source));\r\n\r\n    const sortableList = new SortableList({\r\n      items\r\n    });\r\n\r\n    imageListContainer.append(sortableList.element);\r\n  }\r\n\r\n  getImageItem(url, name) {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <li class=\"products-edit__imagelist-item sortable-list__item\">\r\n        <span>\r\n          <img src=\"icon-grab.svg\" data-grab-handle alt=\"grab\">\r\n          <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(name)}\" src=\"${escapeHtml(url)}\">\r\n          <span>${escapeHtml(name)}</span>\r\n        </span>\r\n        <button type=\"button\">\r\n          <img src=\"icon-trash.svg\" alt=\"delete\" data-delete-handle>\r\n        </button>\r\n      </li>`;\r\n\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  getCreateProductFormTemplate(categories) {\r\n    return `\r\n      <div class=\"product-form\">\r\n        <form data-element=\"productForm\" class=\"form-grid\">\r\n        <div class=\"form-group form-group__half_left\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Название товара</label>\r\n            <input required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\">\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Описание</label>\r\n          <textarea required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\r\n        </div>\r\n        <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\r\n          <label class=\"form-label\">Фото</label>\r\n          <div data-element=\"imageListContainer\"><ul class=\"sortable-list\"></ul></div>\r\n          <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline fit-content\"><span>Загрузить</span></button>\r\n        </div>\r\n        ${this.getProductCategoriesTemplate(categories)}\r\n        <div class=\"form-group form-group__half_left form-group__two-col\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Цена ($)</label>\r\n            <input required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"100\">\r\n          </fieldset>\r\n          <fieldset>\r\n            <label class=\"form-label\">Скидка ($)</label>\r\n            <input required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"0\">\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Количество</label>\r\n          <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"1\">\r\n        </div>\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Статус</label>\r\n          <select class=\"form-control\" name=\"status\">\r\n            <option value=\"1\">Активен</option>\r\n            <option value=\"0\">Неактивен</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-buttons\">\r\n          <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n            Добавить товар\r\n          </button>\r\n        </div>\r\n      </form>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.subElements = {};\r\n  }\r\n\r\n}\r\n","import ProductForm from '../../../components/product-form/index.js';\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  constructor(match) {\r\n    this.match = match;\r\n  }\r\n\r\n  async initComponents () {\r\n    const [, productId] = this.match;\r\n    const productForm = new ProductForm(productId);\r\n    await productForm.render();\r\n    this.components.productForm = productForm;\r\n  }\r\n\r\n  get template () {\r\n    return `\r\n    <div class=\"products-edit\">\r\n      <div class=\"content__top-panel\">\r\n        <h1 class=\"page-title\">\r\n          <a href=\"/products\" class=\"link\">Товары</a> / Добавить\r\n        </h1>\r\n      </div>\r\n      <div class=\"content-box\">\r\n        <div data-element=\"productForm\">\r\n          <!-- product-form component -->\r\n        </div>\r\n      </div>\r\n    </div>`;\r\n  }\r\n\r\n  async render () {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.template;\r\n\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(this.element);\r\n\r\n    await this.initComponents();\r\n\r\n    this.renderComponents();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  renderComponents () {\r\n    Object.keys(this.components).forEach(component => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n      root.append(element);\r\n    });\r\n  }\r\n\r\n  getSubElements ($element) {\r\n    const elements = $element.querySelectorAll('[data-element]');\r\n\r\n    return [...elements].reduce((accum, subElement) => {\r\n      accum[subElement.dataset.element] = subElement;\r\n\r\n      return accum;\r\n    }, {});\r\n  }\r\n\r\n  destroy () {\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","export const foo = 1;\r\n\r\nexport default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n\r\n\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}