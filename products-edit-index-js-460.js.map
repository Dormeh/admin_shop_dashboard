{"version":3,"sources":["webpack://project-structure/./src/components/notification/index.js","webpack://project-structure/./src/components/sortable-list/index.js","webpack://project-structure/./src/utils/escape-html.js","webpack://project-structure/./src/components/product-form/index.js","webpack://project-structure/./src/pages/products/edit/index.js","webpack://project-structure/./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","render","isAlreadyShow","remove","getTemplate","element","document","createElement","innerHTML","firstElementChild","classList","add","show","body","append","setTimeout","destroy","SortableList","items","event","target","closest","preventDefault","elMove","elShift","pageY","getBoundingClientRect","top","dragStart","removeItem","moveDraggingAt","clientX","clientY","style","display","elemBelow","elementFromPoint","elFromList","placeHoldIndex","children","indexOf","length","direction","placeholderElem","movePlaceholderAt","dragStop","elem","addItem","addEventListener","onPointerDown","dispatchEvent","CustomEvent","bubbles","details","item","elementInitialIndex","x","y","className","width","offsetWidth","height","offsetHeight","after","onDocumentPointerMove","onDocumentPointerUp","left","before","placeholderIndex","replaceWith","removeEventListener","detail","string","replace","ProductForm","productId","title","description","quantity","subcategory","status","images","price","discount","save","fileInput","accept","onchange","async","file","files","result","formData","FormData","subElements","productForm","uploadImage","disabled","fetchJson","method","headers","Authorization","referrer","error","Error","push","url","data","link","source","name","imageList","renderImageElem","hidden","appendChild","click","template","createCategoriesSelect","defaultFormData","categoriesPromise","loadCategoriesList","productPromise","loadProductData","Promise","resolve","categoriesData","productResponse","all","productData","categories","renderForm","setFormData","initEventListeners","qetEmptyTemplate","getSubElements","createImagesList","imageListContainer","productCategory","optionProduct","options","find","value","selected","arr","querySelectorAll","dataset","map","subcategories","id","join","product","getFormData","JSON","stringify","console","parseInt","onSubmit","liEl","escapeHtml","Page","match","URL","process","initComponents","components","component","Object","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","super","window","reason","alert"],"mappings":"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","file":"products-edit-index-js-460.js","sourcesContent":["export default class NotificationMessage {\r\n  element;\r\n  constructor(message = '', {\r\n    duration = 1000,\r\n    type = 'success',\r\n  } = {}) {\r\n    this.duration = duration;\r\n    this.message = message;\r\n    this.type = type;\r\n    this.render();\r\n    if (NotificationMessage.isAlreadyShow) {\r\n      NotificationMessage.isAlreadyShow.remove(NotificationMessage.isAlreadyShow);\r\n    } else {\r\n      NotificationMessage.isAlreadyShow = false;\r\n    }\r\n  }\r\n  getTemplate () {\r\n    return `<div class=\"notification\" style=\"--value:2s\">\r\n    <div class=\"timer\"></div>\r\n    <div class=\"inner-wrapper\">\r\n      <div class=\"notification-header\">${this.type}</div>\r\n      <div class=\"notification-body\">${this.message}</div>\r\n    </div>\r\n  </div>`;\r\n  }\r\n  render() {\r\n    const element = document.createElement('div'); // (*)\r\n    element.innerHTML = this.getTemplate();\r\n    this.element = element.firstElementChild;\r\n    this.element.classList.add(this.type);\r\n  }\r\n  show(element = document.body) {\r\n    element.append(this.element);\r\n    NotificationMessage.isAlreadyShow = this.element;\r\n    const timer = setTimeout(() => this.remove(), this.duration);\r\n    return this.element;\r\n  }\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n  destroy() {\r\n    this.remove();\r\n  }\r\n}\r\n","export default class SortableList {\r\n  constructor({\r\n    items = []\r\n  } = {}) {\r\n    this.items = items;\r\n    this.render();\r\n  }\r\n  render() {\r\n    this.element = document.createElement(\"ul\");\r\n    this.element.classList.add('sortable-list');\r\n    for (const elem of this.items) {\r\n      this.addItem(elem);\r\n    }\r\n    this.element.addEventListener('pointerdown', this.onPointerDown);\r\n  }\r\n  onPointerDown = (event) => {\r\n    const element = event.target.closest('.sortable-list__item');\r\n    if (!element) return;\r\n    if (event.target.closest('[data-grab-handle]')) {\r\n      event.preventDefault();\r\n      this.elMove = element;\r\n      this.elShift = event.pageY - element.getBoundingClientRect().top;\r\n      event.preventDefault();\r\n      this.dragStart(element, event);\r\n    }\r\n    if (event.target.closest(\"[data-delete-handle]\")) {\r\n      this.removeItem(element);\r\n    }\r\n  };\r\n  addItem(elem) {\r\n    elem.classList.add(\"sortable-list__item\");\r\n    this.element.append(elem);\r\n  }\r\n  removeItem(element) {\r\n    element.remove();\r\n    this.element.dispatchEvent(new CustomEvent(\"sortable-list-delete\", {\r\n      bubbles: true,\r\n      details: {\r\n        item: element\r\n      }\r\n    }))\r\n  }\r\n  dragStart(element, {clientX, clientY}) {\r\n    this.elementInitialIndex = [...this.element.children].indexOf(element);\r\n    this.elShift = {\r\n      x: clientX - element.getBoundingClientRect().x,\r\n      y: clientY - element.getBoundingClientRect().y\r\n    };\r\n    this.elMove = element;\r\n    this.placeholderElem = document.createElement(\"div\");\r\n    this.placeholderElem.className = \"sortable-list__placeholder\";\r\n    element.style.width = element.offsetWidth + \"px\";\r\n    element.style.height = element.offsetHeight + \"px\";\r\n    this.placeholderElem.style.width = element.style.width;\r\n    this.placeholderElem.style.height = element.style.height;\r\n    element.classList.add(\"sortable-list__item_dragging\");\r\n    element.after(this.placeholderElem);\r\n    this.element.append(element);\r\n    this.moveDraggingAt(clientX, clientY);\r\n    document.addEventListener(\"pointermove\", this.onDocumentPointerMove);\r\n    document.addEventListener(\"pointerup\", this.onDocumentPointerUp);\r\n  }\r\n  moveDraggingAt(x, y) {\r\n    this.elMove.style.left = x - this.elShift.x + \"px\";\r\n    this.elMove.style.top = y - this.elShift.y + \"px\";\r\n  }\r\n  onDocumentPointerMove = (event) => {\r\n    this.moveDraggingAt(event.clientX, event.clientY);\r\n    this.elMove.style.display = 'none';\r\n    let elemBelow = document.elementFromPoint(event.clientX, event.clientY);\r\n    this.elMove.style.display = '';\r\n    if (!elemBelow) return;\r\n    const elFromList = elemBelow.closest('.sortable-list__item');\r\n    if (!elemBelow.closest('.sortable-list__placeholder') && elFromList) {\r\n      const placeHoldIndex = [...this.element.children].indexOf(elFromList);\r\n      if (placeHoldIndex > this.element.children.length || placeHoldIndex < 0) return;\r\n      const direction = elFromList.getBoundingClientRect().top > this.placeholderElem.getBoundingClientRect().top\r\n        ? 1 : 0;\r\n      this.movePlaceholderAt(elFromList, direction);\r\n    }\r\n  };\r\n  movePlaceholderAt(elFromList, direction) {\r\n    direction ? elFromList.after(this.placeholderElem) : elFromList.before(this.placeholderElem);\r\n\r\n  }\r\n  onDocumentPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  dragStop () {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElem);\r\n    this.placeholderElem.replaceWith(this.elMove);\r\n    this.elMove.classList.remove('sortable-list__item_dragging');\r\n    this.elMove.style.width = '';\r\n    this.elMove.style.height = '';\r\n    this.elMove.style.left = '';\r\n    this.elMove.style.top = '';\r\n    this.placeholderElem.remove();\r\n    document.removeEventListener(\"pointermove\", this.onDocumentPointerMove);\r\n    document.removeEventListener(\"pointerup\", this.onDocumentPointerUp);\r\n    this.elMove = null;\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.element.dispatchEvent(new CustomEvent('sortable-list-reorder', {\r\n        bubbles: true,\r\n        detail: {\r\n          item: this.element,\r\n        }\r\n      }));\r\n    }\r\n  }\r\n\r\n  remove () {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.element.removeEventListener('pointerdown', this.onPointerDown);\r\n    document.removeEventListener(\"pointermove\", this.onDocumentPointerMove);\r\n    document.removeEventListener(\"pointerup\", this.onDocumentPointerUp);\r\n    this.element.remove();\r\n  }\r\n}\r\n","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","import SortableList from '../sortable-list/index.js';\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\nconst URL_PATH = process.env.URL_PATH;\r\n\r\nimport { log } from 'webpack-dev-server/client/utils/log';\r\n\r\nconst IMGUR_CLIENT_ID = process.env.IMGUR_CLIENT_ID;\r\nconst BACKEND_URL = process.env.BACKEND_URL;\r\n\r\nexport default class ProductForm {\r\n  subElements = {};\r\n  defaultFormData = [{\r\n    title: '',\r\n    description: '',\r\n    quantity: 1,\r\n    subcategory: '',\r\n    status: 1,\r\n    images: [],\r\n    price: 100,\r\n    discount: 0,\r\n  }];\r\n  constructor (productId) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  onSubmit = event => {\r\n    event.preventDefault();\r\n\r\n    this.save();\r\n  };\r\n\r\n  template() {\r\n    return `<div class=\"products-edit\">\r\n      <div class=\"content__top-panel\">\r\n        <h1 class=\"page-title\">\r\n          <a href=\"/products\" class=\"link\">Товары</a> / ${this.productId ? \"Редактировать\" : \"Добавить\"}\r\n        </h1>\r\n      </div>\r\n      <div class=\"content-box\">\r\n\r\n    <div class=\"product-form\">\r\n    \r\n    <form data-element=\"productForm\" class=\"form-grid\">\r\n      <div class=\"form-group form-group__half_left\">\r\n        <fieldset>\r\n          <label class=\"form-label\">Название товара</label>\r\n          <input required=\"\" type=\"text\" name=\"title\" class=\"form-control\" placeholder=\"Название товара\">\r\n        </fieldset>\r\n      </div>\r\n      \r\n      <div class=\"form-group form-group__wide\">\r\n        <label class=\"form-label\">Описание</label>\r\n        <textarea required=\"\" class=\"form-control\" name=\"description\" data-element=\"productDescription\" placeholder=\"Описание товара\"></textarea>\r\n      </div>\r\n      \r\n      <div class=\"form-group form-group__wide\" data-element=\"sortable-list-container\">\r\n        <label class=\"form-label\">Фото</label>\r\n\r\n        <div data-element=\"imageListContainer\">\r\n        </\\div>\r\n\r\n        <button type=\"button\" name=\"uploadImage\" class=\"button-primary-outline fit-content\"><span>Загрузить</span></button>\r\n      </div>\r\n      \r\n      <div class=\"form-group form-group__half_left\">\r\n        <label class=\"form-label\">Категория</label>\r\n        <select class=\"form-control\" name=\"subcategory\">\r\n            ${this.createCategoriesSelect()}\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"form-group form-group__half_left form-group__two-col\">\r\n        <fieldset>\r\n          <label class=\"form-label\">Цена ($)</label>\r\n          <input required=\"\" type=\"number\" name=\"price\" class=\"form-control\" placeholder=\"${this.defaultFormData.price}\">\r\n        </fieldset>\r\n        <fieldset>\r\n          <label class=\"form-label\">Скидка ($)</label>\r\n          <input required=\"\" type=\"number\" name=\"discount\" class=\"form-control\" placeholder=\"${this.defaultFormData.discount}\">\r\n        </fieldset>\r\n      </div>\r\n      \r\n      <div class=\"form-group form-group__part-half\">\r\n        <label class=\"form-label\">Количество</label>\r\n        <input required=\"\" type=\"number\" class=\"form-control\" name=\"quantity\" placeholder=\"${this.defaultFormData.quantity}\">\r\n      </div>\r\n      <div class=\"form-group form-group__part-half\">\r\n        <label class=\"form-label\">Статус</label>\r\n        <select class=\"form-control\" name=\"status\">\r\n          <option value=\"1\">Активен</option>\r\n          <option value=\"0\">Неактивен</option>\r\n        </select>\r\n      </div>\r\n      <div class=\"form-buttons\">\r\n        <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n          ${this.productId ? \"Сохранить\" : \"Добавить\"} товар\r\n        </button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n  </div>\r\n`;\r\n  }\r\n\r\n  async render () {\r\n    const categoriesPromise = this.loadCategoriesList();\r\n    const productPromise = this.productId\r\n      ? this.loadProductData(this.productId)\r\n      : Promise.resolve(this.defaultFormData);\r\n    const [categoriesData, productResponse] = await Promise.all([categoriesPromise, productPromise]);\r\n    const [productData] = productResponse;\r\n\r\n    this.formData = productData;\r\n    this.categories = categoriesData;\r\n    this.renderForm();\r\n    if (this.formData) {\r\n      this.setFormData();\r\n      this.initEventListeners();\r\n      return this.element;\r\n    }\r\n  }\r\n  renderForm() {\r\n    const element = document. createElement('div');\r\n    element.innerHTML = this.formData\r\n      ? this.template()\r\n      : this.qetEmptyTemplate();\r\n    this.element = element.firstElementChild;\r\n\r\n    this.getSubElements(element);\r\n    const items = this.createImagesList();\r\n    this.imageList = new SortableList({items});\r\n    this.subElements.imageListContainer.append(this.imageList.element);\r\n    const productCategory = this.formData.subcategory;\r\n    const selectArr = this.subElements.productForm.subcategory.options;\r\n    const optionProduct = [...selectArr].find(elem => {\r\n      return elem.value === productCategory;\r\n    });\r\n    if ( optionProduct ) {\r\n      optionProduct.selected = true;\r\n    }\r\n  }\r\n  qetEmptyTemplate() {\r\n    return `<div class=\"error-404\">\r\n      <h1 class=\"page-title\">Страница не найдена</h1>\r\n      <p>Извините, страница не существует</p>\r\n    </div>`;\r\n  }\r\n  getSubElements(element) {\r\n    const arr = element.querySelectorAll('[data-element]');\r\n    for (const elem of arr) {\r\n      this.subElements[elem.dataset.element] = elem;\r\n    }\r\n  }\r\n\r\n  async loadProductData() {\r\n    return fetchJson(`https://course-js.javascript.ru/api/rest/products?id=${this.productId}`);\r\n  }\r\n\r\n  async loadCategoriesList() {\r\n    return fetchJson(\"https://course-js.javascript.ru/api/rest/categories?_sort=weight&_refs=subcategory\");\r\n\r\n  }\r\n\r\n  setFormData() {\r\n    const {title, description, price, discount, quantity, status} = this.formData;\r\n    this.subElements.productForm.title.value = title;\r\n    this.subElements.productForm.description.value = description;\r\n    this.subElements.productForm.price.value = price;\r\n    this.subElements.productForm.discount.value = discount;\r\n    this.subElements.productForm.quantity.value = quantity;\r\n    this.subElements.productForm.status.value = status;\r\n  }\r\n  createCategoriesSelect() {\r\n    return this.categories.map(elem => elem.subcategories\r\n      .map(item => {\r\n        return `<option value=\"${item.id}\">${elem.title} > ${item.title}</option>`;\r\n      })\r\n      .join(''))\r\n      .join('');\r\n\r\n  }\r\n\r\n  async save() {\r\n    const product = this.getFormData();\r\n\r\n    try {\r\n      const result = await fetchJson(`${BACKEND_URL}/api/rest/products`,\r\n        {\r\n          method: this.productId ? 'PATCH' : 'PUT',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify(product)\r\n        });\r\n\r\n      const event = this.productId ? new CustomEvent(\"product-saved\", {detail: result.id}) : new CustomEvent(\"product-updated\", {detail: result.id});\r\n      this.element.dispatchEvent(event);\r\n\r\n    } catch (error) {\r\n      console.error('Ошибка в отправке формы', error);\r\n    }\r\n  }\r\n\r\n  getFormData() {\r\n    const {productForm} = this.subElements;\r\n    const {title, description, subcategory, price, quantity, discount, status} = productForm;\r\n    return {\r\n      id: this.productId,\r\n      title: title.value,\r\n      description: description.value,\r\n      subcategory: subcategory.value,\r\n      price: parseInt(price.value, 10),\r\n      quantity: parseInt(quantity.value, 10),\r\n      discount: parseInt(discount.value, 10),\r\n      status: parseInt(status.value, 10),\r\n      images: this.formData.images\r\n    };\r\n\r\n  }\r\n\r\n  initEventListeners() {\r\n    const {productForm, imageListContainer} = this.subElements;\r\n\r\n    productForm.addEventListener('submit', this.onSubmit);\r\n\r\n    productForm.uploadImage.addEventListener('click', this.uploadImage) ;\r\n\r\n    imageListContainer.addEventListener('click', event => {\r\n      if ('deleteHandle' in event.target.dataset)\r\n        event.target.closest('li').remove();\r\n    });\r\n  }\r\n  uploadImage = () => {\r\n    const fileInput = document.createElement(\"input\");\r\n    fileInput.type = \"file\";\r\n    fileInput.accept = \"image/*\";\r\n    fileInput.onchange = async()=>{\r\n      const [file] = fileInput.files;\r\n      if (!file)\r\n        return;\r\n      let result; const formData = new FormData();\r\n      formData.append(\"image\", file);\r\n      this.subElements.productForm.uploadImage.classList.add(\"is-loading\");\r\n      this.subElements.productForm.uploadImage.disabled = true;\r\n\r\n      try {\r\n        result = await fetchJson(\"https://api.imgur.com/3/image\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            Authorization: `Client-ID ${IMGUR_CLIENT_ID}`\r\n          },\r\n          body: formData,\r\n          referrer: ''\r\n        });\r\n      } catch (error) {\r\n        return new Error(\"Upload error: \" + error.message);\r\n      } finally {\r\n        this.subElements.productForm.uploadImage.classList.remove(\"is-loading\");\r\n        this.subElements.productForm.uploadImage.disabled = false;\r\n      }\r\n\r\n      this.formData.images.push({url: result.data.link, source: file.name});\r\n      this.imageList.addItem(this.renderImageElem({\r\n        url: result.data.link,\r\n        source: file.name\r\n      }));\r\n    };\r\n    fileInput.hidden = true;\r\n    document.body.appendChild(fileInput);\r\n    fileInput.click();\r\n  };\r\n\r\n  createImagesList() {\r\n    if (!this.formData)\r\n      return '';\r\n    return this.formData.images.map(item => this.renderImageElem(item));\r\n  }\r\n  renderImageElem ({url, source}) {\r\n    const liEl = document.createElement('li');\r\n    liEl.classList.add('products-edit__imagelist-item');\r\n    liEl.innerHTML = `<input type=\"hidden\" name=\"url\" value=\"${url}\">\r\n                    <input type=\"hidden\" name=\"source\" value=\"${source}\">\r\n      <span>\r\n      <img src=\"../${URL_PATH}icon-grab.svg\" data-grab-handle alt=\"grab\">\r\n      <img class=\"sortable-table__cell-img\" alt=\"Image\" src=\"${escapeHtml(url)}\">\r\n      <span>${escapeHtml(source)}</span>\r\n      </span>\r\n      <button type=\"button\">\r\n      <img src=\"../${URL_PATH}icon-trash.svg\" data-delete-handle alt=\"delete\">\r\n      </button>`;\r\n    return liEl;\r\n  }\r\n\r\n  remove () {\r\n    this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    const {productForm} = this.subElements;\r\n    productForm.uploadImage.removeEventListener('click', this.uploadImage);\r\n    productForm.removeEventListener('submit', this.onSubmit);\r\n    this.remove();\r\n  }\r\n}\r\n","import ProductForm from '../../../components/product-form/index.js';\r\nimport NotificationMessage from '../../../components/notification/index.js'\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL;\r\n\r\nexport default class Page {\r\n  subElements = {};\r\n  components = {};\r\n  url = new URL('api/dashboard/bestsellers', BACKEND_URL);\r\n  constructor(\r\n    match = ''\r\n  ){\r\n    this.productId = match[0].replace(/products\\/(.+)/, (...match) => {\r\n      return match[1] !== 'add' ? match[1] : ''\r\n    });\r\n  }\r\n  initComponents() {\r\n    const productForm = new ProductForm(this.productId);\r\n\r\n    this.components = {\r\n      productForm,\r\n    };\r\n  }\r\n\r\n  async render() {\r\n    this.initComponents();\r\n    await this.components.productForm.render();\r\n    this.initEventListeners();\r\n    return this.components.productForm.element;\r\n  }\r\n\r\n  initEventListeners() {\r\n    this.components.productForm.element.addEventListener('product-saved', event => {\r\n      console.error('product-saved', event.detail);\r\n      const notification = new NotificationMessage('Товар сохранен', {\r\n        duration: 2000,\r\n        type: 'success'\r\n      });\r\n\r\n      notification.show();\r\n    });\r\n\r\n    this.components.productForm.element.addEventListener('product-updated', event => {\r\n      console.error('product-updated', event.detail);\r\n      const notification = new NotificationMessage('Товар добавлен', {\r\n        duration: 2000,\r\n        type: 'success'\r\n      });\r\n\r\n      notification.show();\r\n    })\r\n\r\n  }\r\n  destroy() {\r\n    this.subElements = {};\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}